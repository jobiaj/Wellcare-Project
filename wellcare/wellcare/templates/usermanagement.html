{% load admin_static i18n %}
{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
    {% block head %}
    {% include "base_site.html" %}
    {% endblock %}
    <script>
    
    </script>   

    <body data-sa-theme="1">
        <main class="main">
            <div class="page-loader">
                <div class="page-loader__spinner">
                    <svg viewBox="25 25 50 50">
                        <circle cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
                    </svg>
                </div>
            </div>
            {% block topbar %}
            {% include "topbar.html" %}
            {% endblock %}         

            {% block sidebarmenu %}
                 {% include "menu.html" %}
            {% endblock %}

            {% block themes %}
                 {% include "themes.html" %}
            {% endblock %}

            <section class="content">
                <header class="content__title">
                    <h1>Profile Informations</h1>

                    <div class="actions">
                            <a href = "" id="" class="actions__item zmdi zmdi-trending-up"></a>
                            <a href="" class="actions__item zmdi zmdi-check-all"></a>

                            <div class="dropdown actions__item">
                                <i data-toggle="dropdown" class="zmdi zmdi-more-vert"></i>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="" class="dropdown-item">Refresh</a>
                                    <a href="" class="dropdown-item">Manage Widgets</a>
                                    <a href="" class="dropdown-item">Settings</a>
                                </div>
                            </div>
                        </div>
                </header>
                    <div class="card widget-contacts">
                        <div class="card-body">
                            <div class="card-body">
                        <h4 class="card-title">Users</h4>
                        <h6 class="card-subtitle">Click on the user to view details</h6>

                        <div class="table-responsive">
                            <div id="data-table_wrapper" class="dataTables_wrapper no-footer"><div class="dataTables_buttons hidden-sm-down actions"><span class="actions__item zmdi zmdi-print" data-table-action="print"></span><span class="actions__item zmdi zmdi-fullscreen" data-table-action="fullscreen"></span><div class="dropdown actions__item"><i data-toggle="dropdown" class="zmdi zmdi-download"></i><ul class="dropdown-menu dropdown-menu-right"><a href="" class="dropdown-item" data-table-action="excel">Excel (.xlsx)</a><a href="" class="dropdown-item" data-table-action="csv">CSV (.csv)</a></ul></div></div><div class="dt-buttons">   <a class="dt-button buttons-excel buttons-html5" tabindex="0" aria-controls="data-table" href="#"><span>Excel</span></a> <a class="dt-button buttons-csv buttons-html5" tabindex="0" aria-controls="data-table" href="#"><span>CSV</span></a> <a class="dt-button buttons-print" tabindex="0" aria-controls="data-table" href="#"><span>Print</span></a> </div><div class="dataTables_length" id="data-table_length"><label>Show <select name="data-table_length" aria-controls="data-table" class=""><option value="15">15 Rows</option><option value="30">30 Rows</option><option value="45">45 Rows</option><option value="-1">Everything</option></select> entries</label></div><div id="data-table_filter" class="dataTables_filter"><label>Search:<input type="search" class="" placeholder="Search for records..." aria-controls="data-table"></label></div><table id="data-table" class="table dataTable no-footer" role="grid" aria-describedby="data-table_info">
                                <thead>
                                    <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending">Name</th><th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Position: activate to sort column ascending">EmailID</th><th class="sorting" tabindex="0" aria-controls="data-table" rowspan="1" colspan="1" aria-label="Office: activate to sort column ascending">PhoneNumber</th></tr>
                                </thead>
                                <tbody>
                                    {% for user in users_info %}  
                                <tr role="row" class="odd">
                                        <td class="sorting_1"><a href="{% url 'user_info_page' user.id %}">{{user.username}}</a></td>
                                        <td>{{user.employee_info.EmailID}}</td>
                                        <td>{{user.employee_info.MobileNumber}}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table><div class="dataTables_info" id="data-table_info" role="status" aria-live="polite">Showing 1 to 15 of 57 entries</div><div class="dataTables_paginate paging_simple_numbers" id="data-table_paginate"><a class="paginate_button previous disabled" aria-controls="data-table" data-dt-idx="0" tabindex="0" id="data-table_previous">Previous</a><span><a class="paginate_button current" aria-controls="data-table" data-dt-idx="1" tabindex="0">1</a><a class="paginate_button " aria-controls="data-table" data-dt-idx="2" tabindex="0">2</a><a class="paginate_button " aria-controls="data-table" data-dt-idx="3" tabindex="0">3</a><a class="paginate_button " aria-controls="data-table" data-dt-idx="4" tabindex="0">4</a></span><a class="paginate_button next" aria-controls="data-table" data-dt-idx="5" tabindex="0" id="data-table_next">Next</a></div></div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
                {% block footer %}
                     {% include "footer.html" %}
                {% endblock %}

            </section>
            <script id="add_user_info" type="text/x-handlebars-template">
                <div class="modal modal-styled fade adduserinfo" tabindex="-1" role="dialog" id="addUserInfo">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title pull-left">Add User Information</h5>
                            </div>
                            <div class="modal-body">
                                <div class="panel panel-default">
                                    <div class="panel-boby">
                                    <form id="upload_form" class="form-horizontal" method="post" role="form"></form>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" id="modal_save_btn" class="btn btn-link">Save changes</button>
                                <button type="button" id="modal_close_btn" class="btn btn-link" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            </script>
            <script src="{% static "js/handlebars-v1.3.0.js" %}"></script>
            <script src="{% static "js/jquery-3.3.1.slim.min.js" %}"></script>
            <script src="{% static "js/popper.min.js" %}"></script>
            <script src="{% static "js/bootstrap.min.js" %}"></script>
             <!-- Vendors: Data tables -->
        <script src="{% static "vendors/bower_components/datatables.net/js/jquery.dataTables.min.js" %}"></script>
        <script src="{% static "vendors/bower_components/datatables.net-buttons/js/dataTables.buttons.min.js" %}"></script>
        <script src="{% static "vendors/bower_components/datatables.net-buttons/js/buttons.print.min.js" %}"></script>
        <script src="{% static "vendors/bower_components/jszip/dist/jszip.min.js" %}"></script>
        <script src="{% static "vendors/bower_components/datatables.net-buttons/js/buttons.html5.min.js" %}"></script>
            <script type="text/javascript">
            $(document).ready(function() {
                $('#btn_user_info').bind('click', function(event){
                    endpoint = "{% url 'add_usr_info' request.user.id %}"
                    var gtcntnt = $.get(endpoint)
                    gtcntnt.done(function(data) {
                        if(data.status){
                            $('body').append(Handlebars.compile($('#add_user_info').html())({}));
                            $('#addUserInfo form').html(data.tmpl);
                            $('#addUserInfo').modal().on('shown.bs.modal', function() {
                                $(this).find('input:first').focus();
                            })
                            $('#addUserInfo form').on('keypress', function (event) {
                                var keycode = (event.keyCode ? event.keyCode : event.which);
                                if (keycode == '13') {
                                    event.preventDefault();
                                    $('#modal_save_btn').trigger('click');

                                }
                                // body...
                            });
                           $('#modal_save_btn').bind('click', function(ev){
                                $('#modal_save_btn').prop('disabled', true);
                                $('#addUserInfo form').unbind('keypress');
                                var prms = $.post(endpoint, $('#upload_form').serialize());
                                prms.done(function(data){
                                    if (data.status && data.complete){
                                        $('#addUserInfo').modal('hide');
                                    } else {
                                        if (data.status){
                                            $('#addUserInfo form').html(data.tmpl);
                                            $('#modal_save_btn').prop('disabled', false);
                                            $('#addUserInfo form').on('keypress', function (event) {
                                            var keycode = (event.keyCode ? event.keyCode : event.which);
                                            if (keycode == '13') {
                                                event.preventDefault();
                                                $('#modal_save_btn').trigger('click');

                                            }
                                // body...
                                           });

                                        } else {
                                            if (data.extra) {
                                                $.howl ({
                                                    type: "info",
                                                    title: "Info",
                                                    content: "Error Happened while saving data",
                                                    iconCls: "fa fa-info"

                                                });
                                                $('#addUserInfo').modal('hide');
                                            }
                                        }
                                    }
                                })

                           }) 
                        // body...
                        } else {
                            if (data.extra) {
                                $.howl({
                                    type: "info",
                                    title: "Info",
                                    content: data.extra,
                                    iconCls: "fa fa-info"
                                });
                                $('#addUserInfo').modal('hide');
                            }
                        }
                });
                });


                $('#edit_user_info').bind('click', function(event){
                    console.log("ready");
                    endpoint = "{% url 'edit_usr_info' request.user.id %}"
                    var gtcntnt = $.get(endpoint)
                    gtcntnt.done(function(data) {
                        if(data.status){
                            $('body').append(Handlebars.compile($('#add_user_info').html())({}));
                            $('#addUserInfo form').html(data.tmpl);
                            $('#addUserInfo').modal().on('shown.bs.modal', function() {
                                $(this).find('input:first').focus();
                            })
                            $('#addUserInfo form').on('keypress', function (event) {
                                var keycode = (event.keyCode ? event.keyCode : event.which);
                                if (keycode == '13') {
                                    event.preventDefault();
                                    $('#modal_save_btn').trigger('click');

                                }
                                // body...
                            });
                           $('#modal_save_btn').bind('click', function(ev){
                                $('#modal_save_btn').prop('disabled', true);
                                $('#addUserInfo form').unbind('keypress');
                                var prms = $.post(endpoint, $('#upload_form').serialize());
                                prms.done(function(data){
                                    if (data.status && data.complete){
                                        $('#addUserInfo').modal('hide');
                                    } else {
                                        if (data.status){
                                            $('#addUserInfo form').html(data.tmpl);
                                            $('#modal_save_btn').prop('disabled', false);
                                            $('#addUserInfo form').on('keypress', function (event) {
                                            var keycode = (event.keyCode ? event.keyCode : event.which);
                                            if (keycode == '13') {
                                                event.preventDefault();
                                                $('#modal_save_btn').trigger('click');

                                            }
                                // body...
                                           });

                                        } else {
                                            if (data.extra) {
                                                $.howl ({
                                                    type: "info",
                                                    title: "Info",
                                                    content: "Error Happened while saving data",
                                                    iconCls: "fa fa-info"

                                                });
                                                $('#addUserInfo').modal('hide');
                                            }
                                        }
                                    }
                                })

                           }) 
                        // body...
                        } else {
                            if (data.extra) {
                                $.howl({
                                    type: "info",
                                    title: "Info",
                                    content: data.extra,
                                    iconCls: "fa fa-info"
                                });
                                $('#addUserInfo').modal('hide');
                            }
                        }
                });
                });

            });

            </script>
        </main>
        <!-- Javascript -->
        <!-- Vendors -->
        {% block bodyjs %}
             {% include "bodyjs.html" %}
        {% endblock %}
    </body>
</html>